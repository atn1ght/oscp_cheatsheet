# SUBVERSION (SVN) ENUMERATION (Port 3690/TCP)

## SERVICE OVERVIEW
```
SVN (Subversion) - Version control system
- Default port: 3690/TCP (svnserve protocol)
- Also accessible via HTTP/HTTPS (80/443)
- Source code repository
- May contain credentials, API keys, sensitive data
- Historical versions may reveal vulnerabilities
```

## BANNER GRABBING & VERSION DETECTION
```bash
nmap -sV -p3690 <IP>                            # Service/Version detection
nc -nv <IP> 3690                                # Manual connection
telnet <IP> 3690                                # Alternative connection

# SVN protocol handshake
echo "( 2 ( edit-pipeline svndiff1 absent-entries commit-revprops depth log-revprops partial-replay ) 36:svn://localhost/test 44:SVN/1.8.10 (x86_64-pc-linux-gnu) ( ) )" | nc -nv <IP> 3690
```

## NMAP ENUMERATION
```bash
# SVN-specific nmap scripts
nmap -p3690 --script svn-brute <IP>             # Brute force authentication
nmap -p3690 --script svn-enum <IP>              # Enumerate repositories

# Version detection
nmap -sV -p3690 <IP>
```

## ENUMERATE REPOSITORIES
```bash
# List repositories (if anonymous access)
svn list svn://<IP>/                            # List root
svn list svn://<IP>/repo                        # List specific repo

# Common repository names to test
for repo in svn repo repository trunk code src project; do
    echo "Testing: $repo"
    svn list svn://<IP>/$repo 2>&1 | grep -v "Unable"
done
```

## ANONYMOUS ACCESS
```bash
# Test anonymous access
svn list svn://<IP>/                            # No auth required?
svn list svn://<IP>/repo                        # Check specific repo

# Checkout repository anonymously
svn checkout svn://<IP>/repo                    # Download entire repo
svn co svn://<IP>/repo                          # Short form
```

## AUTHENTICATED ACCESS
```bash
# Checkout with credentials
svn list svn://<IP>/repo --username <user> --password <pass>
svn checkout svn://<IP>/repo --username <user> --password <pass>

# Store credentials (dangerous in production)
svn list svn://<IP>/repo --username <user> --password <pass> --no-auth-cache
```

## REPOSITORY EXPLORATION
```bash
# After checkout
cd repo

# View commit history
svn log                                         # Full log
svn log -l 10                                   # Last 10 commits
svn log -v                                      # Verbose (shows files changed)

# View specific revision
svn cat -r <revision> <file>                    # View file at revision
svn diff -r <rev1>:<rev2> <file>                # Compare revisions

# Export without .svn directories
svn export svn://<IP>/repo                      # Clean checkout

# List all files
svn list -R svn://<IP>/repo                     # Recursive listing
```

## SEARCH FOR SENSITIVE DATA
```bash
# After checking out repository
cd repo

# Search for credentials
grep -r "password" .
grep -r "api_key" .
grep -r "secret" .
grep -r "token" .

# Common sensitive files
find . -name "*.conf"
find . -name ".env"
find . -name "config.*"
find . -name "credentials.*"
find . -name "*.key"
find . -name "*.pem"

# Check commit messages for keywords
svn log | grep -i "password\|credential\|secret\|api\|key"

# Search historical versions
for rev in $(seq 1 100); do
    echo "Checking revision $rev"
    svn log -r $rev -v | grep -i "password\|credential"
done
```

## RETRIEVE DELETED FILES
```bash
# Deleted files still exist in SVN history
svn log -v | grep "^   D"                       # Find deleted files

# Retrieve deleted file
svn cat -r <revision_before_deletion> <file_path>

# Example: File deleted in r50, retrieve from r49
svn cat -r 49 /path/to/deleted/file.php
```

## BRUTE FORCE ATTACKS
```bash
# Nmap brute force
nmap -p3690 --script svn-brute --script-args userdb=users.txt,passdb=passwords.txt <IP>

# Hydra (limited support)
hydra -L users.txt -P passwords.txt svn://<IP>

# Custom Python script
cat > svn_brute.py <<'EOF'
#!/usr/bin/env python3
import subprocess
import sys

def test_creds(host, repo, user, password):
    cmd = f"svn list svn://{host}/{repo} --username {user} --password {password} --no-auth-cache"
    result = subprocess.run(cmd, shell=True, capture_output=True, text=True)
    return result.returncode == 0

if __name__ == "__main__":
    host = sys.argv[1]
    repo = sys.argv[2]
    with open("users.txt") as uf, open("passwords.txt") as pf:
        for user in uf:
            for password in pf:
                if test_creds(host, repo, user.strip(), password.strip()):
                    print(f"[+] Valid: {user.strip()}:{password.strip()}")
EOF

python3 svn_brute.py <IP> repo
```

## HTTP/HTTPS SVN ACCESS
```bash
# SVN can also be accessed via HTTP/HTTPS
# Check web server for SVN repositories

# Browse to:
http://<IP>/svn/
http://<IP>/repo/
http://<IP>/.svn/                               # Exposed .svn directory (BAD!)

# Checkout via HTTP
svn checkout http://<IP>/svn/repo
svn checkout https://<IP>/svn/repo

# Enumerate via web
curl http://<IP>/svn/
curl http://<IP>/svn/repo/
```

## EXPOSED .SVN DIRECTORY (WEB)
```bash
# If .svn directory is exposed on webserver
# You can reconstruct entire repository!

# Tools to extract .svn
git clone https://github.com/kost/dvcs-ripper
./dvcs-ripper/rip-svn.pl -v -u http://<IP>/.svn/

# Alternative: svn-extractor
git clone https://github.com/anantshri/svn-extractor
python svn-extractor.py http://<IP>/.svn/

# Manual extraction
wget -r http://<IP>/.svn/
```

## METASPLOIT MODULES
```bash
msfconsole
use auxiliary/scanner/svn/svn_scanner            # SVN scanner
use auxiliary/scanner/http/svn_scanner           # HTTP SVN scanner

set RHOSTS <IP>
set RPORT 3690
run
```

## COMMON REPOSITORY PATHS
```bash
# Standard SVN structure
trunk/                                          # Main development
branches/                                       # Feature branches
tags/                                           # Release tags

# Common repo names
svn, repo, repository, code, src, project
main, dev, development, production
```

## INFORMATION GATHERING
```bash
# Get SVN server info
svn info svn://<IP>/repo

# Output includes:
# - Repository Root
# - Repository UUID
# - Revision
# - Node Kind
# - Last Changed Author
# - Last Changed Date

# Get repository properties
svn proplist svn://<IP>/repo
svn propget svn:author svn://<IP>/repo
```

## VULNERABILITY SCANNING
```bash
# Search for SVN exploits
searchsploit subversion
searchsploit svn

# Known vulnerabilities:
# CVE-2013-1968: SVN mod_dav_svn SSRF
# CVE-2013-4277: mod_dav_svn XML parsing
# CVE-2015-0202: mod_dav_svn symlink attack
```

## COMMON MISCONFIGURATIONS
```
☐ Anonymous read access enabled
☐ Anonymous write access (very dangerous!)
☐ .svn directory exposed on webserver
☐ Weak credentials (admin:admin, svn:svn)
☐ No authentication required
☐ Sensitive data committed (passwords, keys)
☐ Credentials in commit messages
☐ API keys, tokens in configuration files
☐ Outdated SVN server with known vulnerabilities
```

## QUICK WIN CHECKLIST
```
☐ Test anonymous access (svn list)
☐ Enumerate repository names
☐ Checkout repository if accessible
☐ Search for credentials in code
☐ Check commit history for sensitive info
☐ Search for .env, config files, API keys
☐ Check for exposed .svn on webserver
☐ Retrieve deleted files from history
☐ Brute force authentication if needed
☐ Look for version-specific exploits
```

## ONE-LINER ENUMERATION
```bash
# Quick SVN enumeration
nmap -sV -p3690 --script svn-* <IP> && svn list svn://<IP>/

# Test common repo names
for r in svn repo trunk code; do svn list svn://<IP>/$r 2>/dev/null && echo "Found: $r"; done
```

## POST-EXPLOITATION
```bash
# After downloading repository:

# 1. Search for credentials
grep -rn "password\|passwd\|pwd" .
grep -rn "api_key\|apikey\|api-key" .
grep -rn "secret\|token\|auth" .

# 2. Check configuration files
find . -name "*.conf" -o -name "*.config" -o -name ".env" -o -name "settings.*"

# 3. Database connection strings
grep -rn "mysql\|postgres\|mongodb\|jdbc"

# 4. SSH/SSL keys
find . -name "*.pem" -o -name "*.key" -o -name "id_rsa"

# 5. Review all revisions
for i in $(seq 1 $(svn info --show-item last-changed-revision)); do
    echo "=== Revision $i ==="
    svn log -r $i -v
done
```

## TOOLS
```bash
# SVN client
apt-get install subversion
svn --version

# dvcs-ripper (.svn extraction)
git clone https://github.com/kost/dvcs-ripper
./rip-svn.pl -v -u http://<IP>/.svn/

# svn-extractor
git clone https://github.com/anantshri/svn-extractor

# Nmap
nmap --script svn-* -p3690 <IP>
```

## SECURITY IMPLICATIONS
```
RISKS:
- Source code disclosure (business logic, algorithms)
- Credentials in code/config files
- API keys and secrets exposure
- Historical vulnerabilities in old code
- Database connection strings
- Internal network topology information
- Developer names and emails (social engineering)
- Intellectual property theft

RECOMMENDATIONS:
- Disable anonymous access
- Require authentication for all operations
- Use strong passwords
- Audit repository for sensitive data
- Use .gitignore / svn:ignore for sensitive files
- Implement pre-commit hooks to prevent credential commits
- Regular security scans of repository
- Restrict access to trusted networks
- Use HTTPS/SSH for SVN access
- Enable audit logging
- Educate developers on secure coding practices
```

## INTEGRATION WITH OTHER ATTACKS
```bash
# 1. Download SVN repository
svn checkout svn://<IP>/repo

# 2. Find database credentials
cd repo
grep -r "mysql\|postgres" . | grep -i "password"

# 3. Use credentials on database service
mysql -h <IP> -u <user> -p<password>

# 4. Find SSH keys
find . -name "id_rsa"
chmod 600 id_rsa
ssh -i id_rsa user@<IP>

# 5. Find web application vulnerabilities in old code
svn log -v | grep "\.php\|\.jsp"
# Review old versions for SQL injection, XSS, etc.
```
